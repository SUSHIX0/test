<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∏ —Å–≤–æ–∏ —Å—Ç–∏–ª–∏ —Å–∞–π—Ç–∞ -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="cart.css">

  <style>
    /* –§–æ–ª–±—ç–∫, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ —Å—Ç–∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å */
    .success-wrap {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }
    .success-title {
      color: #2e7d32;
      margin-bottom: 20px;
    }
    .order-box {
      background: #fafafa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
    }
    .order-info p {
      margin: 6px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }
    .total-row {
      font-weight: bold;
      font-size: 18px;
    }
  </style>
</head>

<body>

<div class="success-wrap">

  <h1 class="success-title">‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ</h1>

  <div class="order-box order-info">
    <p><strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong> <span id="orderId"></span></p>
    <p><strong>–ò–º—è:</strong> <span id="customerName"></span></p>
    <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span id="customerPhone"></span></p>
    <p><strong>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è:</strong> <span id="customerMethod"></span></p>
    <p><strong>–ê–¥—Ä–µ—Å:</strong> <span id="customerAddress"></span></p>
    <p><strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong> <span id="customerDate"></span></p>
  </div>

  <div class="order-box">
    <h2>–í–∞—à –∑–∞–∫–∞–∑</h2>

    <table>
      <thead>
        <tr>
          <th>–¢–æ–≤–∞—Ä</th>
          <th>–¶–µ–Ω–∞</th>
          <th>–ö–æ–ª-–≤–æ</th>
          <th>–ò—Ç–æ–≥–æ</th>
        </tr>
      </thead>
      <tbody id="orderItems"></tbody>
      <tfoot>
        <tr>
          <td colspan="3">–î–æ—Å—Ç–∞–≤–∫–∞</td>
          <td id="deliveryPrice">0.00 ‚Ç¨</td>
        </tr>
        <tr>
          <td colspan="3">–°–∫–∏–¥–∫–∞</td>
          <td id="discountPrice">0.00 ‚Ç¨</td>
        </tr>
        <tr class="total-row">
          <td colspan="3">–ò—Ç–æ–≥–æ</td>
          <td id="orderTotal">0.00 ‚Ç¨</td>
        </tr>
      </tfoot>
    </table>
  </div>

</div>

<script>
  const order = JSON.parse(localStorage.getItem('lastOrder'));

  if (!order) {
    document.body.innerHTML = "<p>–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω</p>";
    throw new Error("Order not found");
  }

  // ===== –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ =====
  document.getElementById('orderId').textContent =
    "ORD-" + order.createdAt;

  // ===== –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ =====
  document.getElementById('customerName').textContent = order.customer.name || "-";
  document.getElementById('customerPhone').textContent = order.customer.phone || "-";
  document.getElementById('customerMethod').textContent = order.customer.method || "-";
  document.getElementById('customerAddress').textContent = order.customer.address || "-";
  document.getElementById('customerDate').textContent =
    `${order.customer.date || ""} ${order.customer.time || ""}`;

  // ===== –¢–æ–≤–∞—Ä—ã =====
  const tbody = document.getElementById('orderItems');
  let total = 0;

  order.cart.forEach(item => {
    const sum = item.unitPrice * item.qty;
    total += sum;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.name}${item.unitPrice === 0 ? ' üéÅ' : ''}</td>
      <td>${item.unitPrice.toFixed(2)} ‚Ç¨</td>
      <td>${item.qty}</td>
      <td>${sum.toFixed(2)} ‚Ç¨</td>
    `;
    tbody.appendChild(tr);
  });

  // ===== –î–æ—Å—Ç–∞–≤–∫–∞ =====
  document.getElementById('deliveryPrice').textContent =
    (order.delivery || 0).toFixed(2) + " ‚Ç¨";
  total += order.delivery || 0;

  // ===== –°–∫–∏–¥–∫–∞ =====
  document.getElementById('discountPrice').textContent =
    "-" + (order.discount || 0).toFixed(2) + " ‚Ç¨";
  total -= order.discount || 0;

  // ===== –ò—Ç–æ–≥–æ =====
  document.getElementById('orderTotal').textContent =
    total.toFixed(2) + " ‚Ç¨";

  // ===== –û—á–∏—Å—Ç–∫–∞ =====
  localStorage.removeItem('cart');
  localStorage.removeItem('activePromo');
  localStorage.removeItem('lastOrder');
</script>

</body>
</html>
