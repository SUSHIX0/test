<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Оплата прошла</title>
<link rel="stylesheet" href="style.css"> <!-- подключи свой CSS с сайта -->
<style>
  body { font-family: sans-serif; padding: 20px; }
  .success-message { text-align: center; margin-bottom: 20px; }
  .order-id { font-weight: bold; }
  .cart-summary { max-width: 600px; margin: auto; }
</style>
</head>
<body>

<div class="success-message">
  <h1>Оплата прошла успешно!</h1>
  <p>Ваш номер заказа: <span class="order-id"></span></p>
</div>

<div class="cart-summary">
  <h2>Ваш заказ:</h2>
  <div class="cart-items"></div>
  <div class="totals">
    <p>Сумма: <span class="subtotal-price"></span></p>
    <p>Доставка: <span class="delivery-price"></span></p>
    <p>Скидка: <span class="discount-price"></span></p>
    <p>Итого: <span class="total-price"></span></p>
  </div>
</div>

<script src="cart.js"></script> <!-- подключи скрипт с корзиной -->
<script>
  // ===== Получаем номер заказа из URL =====
  const params = new URLSearchParams(window.location.search);
  const sessionId = params.get('session_id');
  document.querySelector('.order-id').textContent = sessionId || 'Не найден';

  // ===== Загружаем корзину из localStorage =====
  const cartData = JSON.parse(localStorage.getItem('cart') || '{}');
  const cartItemsContainer = document.querySelector('.cart-items');
  const subtotalEl = document.querySelector('.subtotal-price');
  const deliveryEl = document.querySelector('.delivery-price');
  const discountEl = document.querySelector('.discount-price');
  const totalEl = document.querySelector('.total-price');

  let subtotal = 0;
  for (const id in cartData) {
    const item = cartData[id];
    const line = document.createElement('div');
    line.textContent = `${item.name} × ${item.qty} = ${(item.unitPrice * item.qty).toFixed(2)} €`;
    cartItemsContainer.appendChild(line);
    subtotal += item.unitPrice * item.qty;
  }

  const delivery = parseFloat(localStorage.getItem('delivery')) || 0;
  const discount = parseFloat(localStorage.getItem('discount')) || 0;
  const total = subtotal + delivery - discount;

  subtotalEl.textContent = subtotal.toFixed(2) + ' €';
  deliveryEl.textContent = delivery.toFixed(2) + ' €';
  discountEl.textContent = discount.toFixed(2) + ' €';
  totalEl.textContent = total.toFixed(2) + ' €';

  // ===== Очистка корзины после успешного заказа =====
  localStorage.removeItem('cart');
  localStorage.removeItem('delivery');
  localStorage.removeItem('discount');
  localStorage.removeItem('activePromo');
</script>

</body>
</html>
